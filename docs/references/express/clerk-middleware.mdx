---
title: '`clerkMiddleware()` | Express'
description: The `clerkMiddleware()` function allows you to protect your Express application using Middleware.
---

The `clerkMiddleware()` middleware integrates Clerk authentication and authorization into your Express application.

## Configure `clerkMiddleware()`

Install the Clerk middleware in your Express app:

```ts {{ filename: 'index.ts' }}
import express from 'express'
import { clerkMiddleware } from '@clerk/express'

const app = express()

app.use(clerkMiddleware())
```

## Protect a route

To protect a route, based on user authentication status, use [`auth().userId`](/docs/references/nextjs/auth#retrieving-user-id) to check if the `userId` is present. If it is not, the user is not authenticated, and you can redirect them to the sign-in page.

```ts {{ filename: 'index.ts' }}
import 'dotenv/config' // To read CLERK_SECRET_KEY and CLERK_PUBLISHABLE_KEY
import express from 'express'
import { clerkMiddleware, getAuth } from '@clerk/express'

const app = express()

app.use(clerkMiddleware())

app.get('/protected-endpoint', async (req, res) => {
  const { userId } = getAuth(req)

  if (!userId) {
    return res.redirect('/sign-in')
  }

  const user = await clerkClient.users.getUser(userId)

  return res.json({ user })
})

app.listen(3000, () => {
  console.log(`Example app listening at http://localhost:${port}`)
})
```

## Protect all routes

To protect all routes in your application, you can use the `requireAuth()` function. This strict middleware passes an error to the next error middleware when an unauthenticated request is made, allowing you to respond to the error as you deem fit.

```ts {{ filename: 'index.ts' }}
import 'dotenv/config' // To read CLERK_SECRET_KEY and CLERK_PUBLISHABLE_KEY
import express from 'express'
import { clerkMiddleware, getAuth, UnauthorizedError } from '@clerk/express'

const app = express()

app.use(clerkMiddleware())
app.use(requireAuth())

app.get('/protected-endpoint', async (req, res) => {
  const { userId } = getAuth(req)

  const user = await clerkClient.users.getUser(userId)

  return res.json({ user })
})

app.use((err, req, res, next) => {
  // Use the provided UnauthorizedError class to check if
  // the error is an unauthorized error.
  if (err instanceof UnauthorizedError) {
    return res.status(401).send('Unauthorized')
  }

  return next(err)
})

app.listen(3000, () => {
  console.log(`Example app listening at http://localhost:${port}`)
})
```

## `clerkMiddleware()` options

The `clerkMiddleware()` function accepts an optional object. See the full list of options available [here](/docs/references/nextjs/clerk-middleware#clerk-middleware-options.){{ target: '_blank' }}
